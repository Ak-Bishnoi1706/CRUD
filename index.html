<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MINOR PROJECT</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <nav class="navbar bg-body-tertiary" data-bs-theme="dark">
        <div class="container-fluid">
            <a class="navbar-brand">Student Page</a>
            <form class="d-flex" role="search">
                <input class="form-control me-2" id="searchBox" type="text" placeholder="Search Student" aria-label="Search" />
                <button class="btn btn-outline-success" type="submit">Search</button>
            </form>
        </div>
    </nav>
    <div class="stdform">
        <form id="StudentForm" method="POST" action="/" >
            <div class="input-group mb-3">
                <span class="input-group-text" id="basic-addon1">@</span>
                <input type="text" id="name" name="Username" class="form-control" placeholder="Student name" aria-label="Username"
                    aria-describedby="basic-addon1" required />
            </div>
            <div class="mb-3">
                <label for="InputEmail" class="form-label">Email address</label>
                <input type="email" name="email" class="form-control" id="InputEmail" aria-describedby="emailHelp" required/>
                <div id="emailHelp" class="form-text">We'll never share your email with anyone else.</div>
            </div>
            <div class="mb-3">
                <label for="rollNo" class="form-label">Roll No.</label>
                <input type="text" name="rollno" class="form-control" id="rollNo" place holder="Enter roll no" required />
            </div>
            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="exampleCheck1">
                <label class="form-check-label" for="exampleCheck1">Check me out</label>
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
    </div>
    <table class="table table-dark table-hover">
        <thead>
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Roll No.</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="studentTableBody">

    </tbody>
    </table>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

const firebaseConfig = {
    apiKey: "AIzaSyCfNUJ2LnkrjKRXt13ZquK4YsRh5RY5JBw",
    authDomain: "minor-project-01-382d4.firebaseapp.com",
    projectId: "minor-project-01-382d4",
    storageBucket: "minor-project-01-382d4.firebasestorage.app",
    messagingSenderId: "47003808844",
    appId: "1:47003808844:web:c8e3c22b5ce81744fd70e9",
    measurementId: "G-K814ZL2HJ9"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const database = getDatabase(app);
const studentRef = ref(database, "students");

// Submit data
document.getElementById("StudentForm").addEventListener("submit", (e) => {
  e.preventDefault();

  const name = document.getElementById("name").value;
  const email = document.getElementById("InputEmail").value;
  const rollno = document.getElementById("rollNo").value;

  const newStudentRef = push(studentRef);
  set(newStudentRef, { name, email, rollno });

  document.getElementById("StudentForm").reset();
});

// Fetch
onValue(studentRef, (snapshot) => {
  const tableBody = document.getElementById("studentTableBody");
  tableBody.innerHTML = "";
  snapshot.forEach(child => {
    const student = child.val();
    const id = child.key;

 tableBody.innerHTML += `
      <tr>
        <td>${student.name}</td>
        <td>${student.email}</td>
        <td>${student.rollno}</td>
        <td><button class="delete-btn btn btn-danger btn-sm" data-id="${id}">Delete</button></td>
      </tr>`;
  });
});

// Delete
document.getElementById("studentTableBody").addEventListener("click", (e) => {
  if (e.target.classList.contains("delete-btn")) {
    const id = e.target.getAttribute("data-id");
    remove(ref(database, "students/" + id));
  }
});

// Search
document.getElementById("searchBox").addEventListener("input", function () {
  const query = this.value.toLowerCase();
  const rows = document.querySelectorAll("#studentTableBody tr");

  rows.forEach(row => {
    const name = row.children[0].textContent.toLowerCase();
    const email = row.children[1].textContent.toLowerCase();
    row.style.display = (name.includes(query) || email.includes(query)) ? "" : "none";
  });
});
</script>
</body>
</html>